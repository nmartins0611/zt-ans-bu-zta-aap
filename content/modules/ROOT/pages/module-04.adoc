:doctype: book

= Trigger Infrastructure Provisioning and automation from Terraform Enterprise - Part 2

In this part we will continue the prerequisites and put the final touches on the Terraform Enterprise Workspace.

* Terraform Enterprise
** Cloning a GitHub repository to your account
** Create a Terraform Enterprise Workspace that uses Version Control System (VCS, in this case GitHub) to store the Terraform code
** Trigger Terraform infrastructure provisioning and automation by committing changes to the Terraform code in the GitHub repository.




In this challenge you will learn how to bring in HashiCorp Vault Enterprise to your automation pipeline.

[#task1]
== Clone the GitHub repository to your account

NOTE: You can perform this task in the `TERMINAL` tab from your lab environment (on the vscode terminal prompt), in VS Code directly tab in your lab environment, OR you can do this directly in the GitHub web interface. Whatever is easier for you.

The following repository contains the Terraform code for the infrastructure you will be provisioning.

* https://github.com/ansible-tmm/aap-hashi-lab-2.git

[source,bash,role=execute]
----
git clone https://github.com/ansible-tmm/aap-hashi-lab-2.git
----

Later in this lab, you will be committing changes to the Terraform code in the GitHub repository, which in turn will trigger the Terraform infrastructure provisioning and automation, and will leverage secrets from Vault Enterprise.

[#task2]
== Set up the Terraform Enterprise Workspace

Back in the Terraform Enterprise UI, click on the `Workspaces` menu option in the left menu.

Click on the `New` button on the right, and select `Workspace` from the dropdown.
Enter the following details:
* For the `Project` field, select `rhdp-initial-project` from the dropdown, and select `Create`

image::workspace1.png[]

* On the next screen choose `Version Control Workflow`For the Workspace type

image::workspace2.png[]

Now you will need to configure the Workspace to use the GitHub repository you cloned earlier into your GitHub account.

* Select the `GitHub` option from the dropdown, and then click on the `GitHub.com` button.
* For the `VCS Provider` field, select `GitHub.com`
* You will now be launced to step 2 (set up provider), which is to setup the GitHub repository connection
* Click the `Register a new OAuth Application` link to register a new OAuth application with GitHub.

image::workspace3.png[]

* Authenticate to your GitHub account, and authorize the Terraform Enterprise application to access your GitHub account.
* It will have automatically populated some of the fields for you as they relate to Terraform Enterprise
* Scroll down and click on the `Register application` button

image::workspace4.png[]

* The applciation will now be registered, and you will need to click the `Generate a new client secret` button to generate a new client secret. Copy both the `Client ID` and `Client Secret`, you will need these momentarily.

image::workspace5.png[]

* Go back to the Terraform Enterprise UI, and paste the `Client ID` and `Client Secret` into the respective fields, and provide a `Name` for VCS provider.  For the nameI use my initial, followed by dash and github, example: `jdoe-github`
* Click on the `Connect and Continue` button to save the VCS provider configuration

image::workspace6.png[]

* On the next screen, you will need to choose the repository you want to use for this workspace.  For this lab, we will use the repository you cloned earlier into your GitHub account
* On the following screen, you will need to provide the `Workspace Name`.  For this lab, we will use `TFE-Demo-VCS`
* For the `Description` field, enter `Using GitHub commits to trigger Plan/Apply Runs`
* Expand the `Advanced Options` section, and check both of the `Auto-apply` option checkboxes. This will automatically apply the changes to the workspace when you commit changes to the repository.
* For the `Terraform Working Directory` field, enter `TF_templates/AWS/`
* Scroll down the bottom of the screen and click on the `Create` button to save the workspace configuration

image::workspace7.png[]

While you still have GitHub open, navigate to the repository you cloned earlier into your GitHub account please perform the following:

* Navigate to the repository `SETTINGS` -> `WEBHOOKS`
* You will see the Terraform Enterprise webhook configuration, click on the `Edit` button
* Scroll down to the `SSL verification` section, and check the `Disable` checkbox

image::workspace8.png[]









[#task3]
== Trigger infrastructure provisioning and automation


